{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{toast}from'react-hot-toast';import{authAPI}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Check if user is already logged in on app start\nconst savedToken=localStorage.getItem('token');const savedUser=localStorage.getItem('user');console.log('üîÑ AuthContext init - checking saved auth data');console.log('üìä Saved token exists:',!!savedToken);console.log('üìä Saved user exists:',!!savedUser);if(savedToken&&savedUser){try{const userData=JSON.parse(savedUser);console.log('üîÑ Restoring user session:',userData.name);setToken(savedToken);setUser(userData);}catch(error){console.error('‚ùå Error parsing saved user data:',error);localStorage.removeItem('token');localStorage.removeItem('user');}}else{console.log('üîÑ No saved authentication data found');}setLoading(false);},[]);const sendOTP=async phoneNumber=>{try{const response=await authAPI.sendOTP(phoneNumber);if(response.success){// Remove duplicate toast - let Login component handle the UI feedback\nreturn;}else{throw new Error(response.message||'Failed to send OTP');}}catch(error){var _error$response,_error$response$data;const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||error.message||'Failed to send OTP';toast.error(errorMessage);throw error;}};const login=async(phoneNumber,otp)=>{try{console.log('üîê Starting login process for:',phoneNumber);const response=await authAPI.verifyOTP(phoneNumber,otp);console.log('üîê Login response:',response);if(response.success&&response.data){const{token:newToken,user:userData}=response.data;console.log('üîê Login successful, setting user data:',userData);// Save to localStorage first\nlocalStorage.setItem('token',newToken);localStorage.setItem('user',JSON.stringify(userData));// Update state\nsetToken(newToken);setUser(userData);console.log('üîê State updated, user:',userData);console.log('üîê LocalStorage token:',!!localStorage.getItem('token'));console.log('üîê LocalStorage user:',!!localStorage.getItem('user'));// Remove duplicate toast - let Login component handle the UI feedback\n// State updates are synchronous, React Router will handle navigation\nconsole.log('üîê Login process completed successfully');}else{throw new Error(response.message||'Login failed');}}catch(error){var _error$response2,_error$response2$data;console.error('üîê Login error:',error);const errorMessage=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||error.message||'Login failed';toast.error(errorMessage);throw error;}};const logout=()=>{// Clear localStorage\nlocalStorage.removeItem('token');localStorage.removeItem('user');// Clear state\nsetToken(null);setUser(null);toast.success('Logged out successfully');};const contextValue={user,token,loading,login,logout,sendOTP};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","toast","authAPI","jsx","_jsx","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","token","setToken","loading","setLoading","savedToken","localStorage","getItem","savedUser","console","log","userData","JSON","parse","name","error","removeItem","sendOTP","phoneNumber","response","success","message","_error$response","_error$response$data","errorMessage","data","login","otp","verifyOTP","newToken","setItem","stringify","_error$response2","_error$response2$data","logout","contextValue","Provider","value"],"sources":["C:/Users/KulkarniSr/Downloads/CURSOR-PROJECT/CURSOR-PROJECT/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { authAPI } from '../services/api';\r\nimport { User, AuthContextType } from '../types';\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const useAuth = (): AuthContextType => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface AuthProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [token, setToken] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n\r\n  useEffect(() => {\r\n    // Check if user is already logged in on app start\r\n    const savedToken = localStorage.getItem('token');\r\n    const savedUser = localStorage.getItem('user');\r\n    \r\n    console.log('üîÑ AuthContext init - checking saved auth data');\r\n    console.log('üìä Saved token exists:', !!savedToken);\r\n    console.log('üìä Saved user exists:', !!savedUser);\r\n    \r\n    if (savedToken && savedUser) {\r\n      try {\r\n        const userData = JSON.parse(savedUser);\r\n        console.log('üîÑ Restoring user session:', userData.name);\r\n        setToken(savedToken);\r\n        setUser(userData);\r\n      } catch (error) {\r\n        console.error('‚ùå Error parsing saved user data:', error);\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n      }\r\n    } else {\r\n      console.log('üîÑ No saved authentication data found');\r\n    }\r\n    \r\n    setLoading(false);\r\n  }, []);\r\n\r\n  const sendOTP = async (phoneNumber: string): Promise<void> => {\r\n    try {\r\n      const response = await authAPI.sendOTP(phoneNumber);\r\n      if (response.success) {\r\n        // Remove duplicate toast - let Login component handle the UI feedback\r\n        return;\r\n      } else {\r\n        throw new Error(response.message || 'Failed to send OTP');\r\n      }\r\n    } catch (error: any) {\r\n      const errorMessage = error.response?.data?.message || error.message || 'Failed to send OTP';\r\n      toast.error(errorMessage);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const login = async (phoneNumber: string, otp: string): Promise<void> => {\r\n    try {\r\n      console.log('üîê Starting login process for:', phoneNumber);\r\n      const response = await authAPI.verifyOTP(phoneNumber, otp);\r\n      console.log('üîê Login response:', response);\r\n      \r\n      if (response.success && response.data) {\r\n        const { token: newToken, user: userData } = response.data;\r\n        \r\n        console.log('üîê Login successful, setting user data:', userData);\r\n        \r\n        // Save to localStorage first\r\n        localStorage.setItem('token', newToken);\r\n        localStorage.setItem('user', JSON.stringify(userData));\r\n        \r\n        // Update state\r\n        setToken(newToken);\r\n        setUser(userData);\r\n        \r\n        console.log('üîê State updated, user:', userData);\r\n        console.log('üîê LocalStorage token:', !!localStorage.getItem('token'));\r\n        console.log('üîê LocalStorage user:', !!localStorage.getItem('user'));\r\n        \r\n        // Remove duplicate toast - let Login component handle the UI feedback\r\n        \r\n        // State updates are synchronous, React Router will handle navigation\r\n        console.log('üîê Login process completed successfully');\r\n        \r\n      } else {\r\n        throw new Error(response.message || 'Login failed');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('üîê Login error:', error);\r\n      const errorMessage = error.response?.data?.message || error.message || 'Login failed';\r\n      toast.error(errorMessage);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = (): void => {\r\n    // Clear localStorage\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    \r\n    // Clear state\r\n    setToken(null);\r\n    setUser(null);\r\n    \r\n    toast.success('Logged out successfully');\r\n  };\r\n\r\n  const contextValue: AuthContextType = {\r\n    user,\r\n    token,\r\n    loading,\r\n    login,\r\n    logout,\r\n    sendOTP,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}